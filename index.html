<!DOCTYPE html>
<html>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    #loading-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #loading-text {
      color: white;
      font-size: 24px;
    }
  </style>
  <script>
    AFRAME.registerComponent("marker-tracker", {
      schema: {
        camera: { type: "selector" },
      },

      init: function () {
        const marker = this.el;
        const camera = this.data.camera;

        this.el.addEventListener("model-loaded", () => {
          const updateMarkerPose = () => {
            const cameraPosition = camera.getAttribute("position");
            const cameraRotation = camera.getAttribute("rotation");

            const cameraQuaternion = new THREE.Quaternion().setFromEuler(
              new THREE.Euler(
                THREE.MathUtils.degToRad(cameraRotation.x),
                THREE.MathUtils.degToRad(cameraRotation.y),
                THREE.MathUtils.degToRad(cameraRotation.z),
                'XYZ'
              )
            );

            const newMarkerPosition = transformLocalToWorldCoordinates(marker.getAttribute('position'), cameraPosition, cameraQuaternion);
            marker.setAttribute("position", newMarkerPosition);
          };

          camera.addEventListener("positionchange", updateMarkerPose);
          camera.addEventListener("rotationchange", updateMarkerPose);
        });
      },
    });

    function transformLocalToWorldCoordinates(localPosition, cameraPosition, cameraQuaternion) {
      const rotatedPosition = new THREE.Vector3(localPosition.x, localPosition.y, localPosition.z).applyQuaternion(cameraQuaternion);
      const offsetVector = new THREE.Vector3(cameraPosition.x, cameraPosition.y, cameraPosition.z);
      rotatedPosition.add(offsetVector);
      return { x: rotatedPosition.x, y: rotatedPosition.y, z: rotatedPosition.z };
    }
  </script>
  <body style="margin: 0px; overflow: hidden;">
    <div id="loading-screen">
      <p id="loading-text">Loading...</p>
    </div>
    <a-scene embedded>
      <a-marker preset="hiro">
        <!-- Your model entities here -->
      </a-marker>
    

      <a-assets>
        <!-- Load your assets here -->
        <a-asset-item id="model1" src="src/XmasTree.gltf"></a-asset-item>
        <a-asset-item id="model2" src="src/surface/scene.gltf"></a-asset-item>
      </a-assets>

      <a-entity>
        <!-- Use asset management to load the models -->
        <a-entity
          id="yourModelEntity"
          scale="2 2 2"
          rotation="0 0 0"
          position="0 0 0"
          gltf-model="#model1"
          animation__rotate="property: rotation; dur: 80000; easing: linear; dir: normal; from:0 0 0; to: 0 360 0; loop: true;"
        ></a-entity>
        <a-entity
          id="yourModelEntity2"
          scale="1 1 1"
          rotation="0 0 0"
          position="0 0 0"
          gltf-model="#model2"
          animation-mixer
        ></a-entity>
      </a-entity>

      <a-entity camera ></a-entity>
    </a-scene>

    <script>
      // Get the loading screen element
      var loadingScreen = document.getElementById('loading-screen');

      // Get the A-Frame scene element
      var scene = document.querySelector('a-scene');

      // Hide the loading screen when assets are loaded
      scene.addEventListener('loaded', function () {
        loadingScreen.style.display = 'none';
      });
    </script>
  </body>
</html>
